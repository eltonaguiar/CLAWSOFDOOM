<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CLAWS OF DOOM v2 - Live Picks with Performance</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'Courier New', monospace;
    background: #0a0a0a;
    color: #fff;
    line-height: 1.6;
    padding: 20px;
  }
  .header {
    text-align: center;
    padding: 30px;
    border-bottom: 3px solid #ff3333;
    margin-bottom: 30px;
  }
  .header h1 {
    font-size: 2.5rem;
    color: #ff3333;
    text-shadow: 0 0 20px #ff3333;
  }
  .header p {
    color: #ff6600;
    margin-top: 10px;
  }
  .stats {
    display: flex;
    justify-content: center;
    gap: 40px;
    margin-bottom: 30px;
    flex-wrap: wrap;
  }
  .stat {
    text-align: center;
  }
  .stat-value {
    font-size: 2rem;
    font-weight: bold;
    color: #00ff66;
  }
  .stat-label {
    font-size: 0.8rem;
    color: #888;
  }
  .picks {
    max-width: 1000px;
    margin: 0 auto;
  }
  .pick {
    background: #141414;
    border: 1px solid #333;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
  }
  .pick-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
  }
  .pick-symbol {
    font-size: 1.5rem;
    font-weight: bold;
    color: #ff3333;
  }
  .pick-strategy {
    font-size: 0.8rem;
    color: #888;
  }
  .pick-time {
    font-size: 0.75rem;
    color: #666;
    margin-top: 5px;
  }
  .pick-confidence {
    display: inline-block;
    padding: 5px 15px;
    border-radius: 4px;
    font-weight: bold;
    font-size: 0.9rem;
  }
  .performance-box {
    background: rgba(255,255,255,0.05);
    padding: 15px;
    border-radius: 4px;
    margin: 15px 0;
  }
  .performance-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    text-align: center;
  }
  .perf-value {
    font-size: 1.5rem;
    font-weight: bold;
  }
  .perf-label {
    font-size: 0.7rem;
    color: #888;
  }
  .positive { color: #00ff66; }
  .negative { color: #ff3333; }
  .pick-details {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 15px;
    margin-top: 15px;
  }
  .detail {
    text-align: center;
  }
  .detail-value {
    font-size: 1.1rem;
    font-weight: bold;
  }
  .detail-label {
    font-size: 0.7rem;
    color: #888;
  }
  .pick-reason {
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid #333;
    font-size: 0.9rem;
    color: #aaa;
  }
  .audit-section {
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid #333;
  }
  .audit-toggle {
    font-size: 0.8rem;
    color: #ff6600;
    cursor: pointer;
  }
  .audit-content {
    display: none;
    margin-top: 10px;
    padding: 15px;
    background: rgba(255,102,0,0.1);
    border-radius: 4px;
    font-size: 0.8rem;
  }
  .warning-box {
    margin-top: 15px;
    padding: 10px;
    background: rgba(255,51,51,0.2);
    border-radius: 4px;
    color: #ff3333;
    font-size: 0.8rem;
  }
  .loading {
    text-align: center;
    padding: 60px;
    color: #888;
  }
  .footer {
    text-align: center;
    margin-top: 40px;
    padding-top: 20px;
    border-top: 1px solid #333;
    color: #666;
    font-size: 0.8rem;
  }
</style>
</head>
<body>

<div class="header">
  <h1>‚ò†Ô∏è CLAWS OF DOOM ‚ò†Ô∏è</h1>
  <p>LIVE PERFORMANCE TRACKING // FULL AUDIT TRAIL</p>
</div>

<div class="stats">
  <div class="stat">
    <div class="stat-value" id="totalPicks">--</div>
    <div class="stat-label">ACTIVE PICKS</div>
  </div>
  <div class="stat">
    <div class="stat-value" id="totalPnL">--</div>
    <div class="stat-label">TOTAL P&L ($)</div>
  </div>
  <div class="stat">
    <div class="stat-value" id="avgConfidence">--</div>
    <div class="stat-label">AVG CONFIDENCE</div>
  </div>
</div>

<div class="picks" id="picksContainer">
  <div class="loading">Loading picks with live performance...</div>
</div>

<div class="footer">
  Updates every 15 minutes | Live P&L tracking | Full audit trails
</div>

<script>
async function loadPicks() {
  const sources = [
    './picks.json',
    'https://raw.githubusercontent.com/eltonaguiar/CLAWSOFDOOM/main/docs/picks.json',
    'https://cdn.jsdelivr.net/gh/eltonaguiar/CLAWSOFDOOM@main/docs/picks.json'
  ];
  
  for (const url of sources) {
    try {
      const resp = await fetch(url, { cache: 'no-store' });
      if (resp.ok) {
        const data = await resp.json();
        renderPicks(data);
        return;
      }
    } catch (e) {
      console.warn('Failed:', url);
    }
  }
  
  document.getElementById('picksContainer').innerHTML = 
    '<div class="loading">Error loading. <button onclick="location.reload()">Refresh</button></div>';
}

function renderPicks(data) {
  const picks = data.picks || [];
  
  document.getElementById('totalPicks').textContent = picks.length;
  
  // Calculate totals
  let totalPnL = 0;
  picks.forEach(p => {
    if (p.performance) totalPnL += p.performance.pnl_amount || 0;
  });
  
  const pnlEl = document.getElementById('totalPnL');
  pnlEl.textContent = (totalPnL >= 0 ? '+' : '') + '$' + totalPnL.toFixed(0);
  pnlEl.style.color = totalPnL >= 0 ? '#00ff66' : '#ff3333';
  
  const avgConf = picks.length > 0 
    ? (picks.reduce((a,b) => a + b.confidence, 0) / picks.length * 100).toFixed(0) + '%'
    : '--';
  document.getElementById('avgConfidence').textContent = avgConf;
  
  if (picks.length === 0) {
    document.getElementById('picksContainer').innerHTML = 
      '<div class="loading">No active picks. Scanning...</div>';
    return;
  }
  
  document.getElementById('picksContainer').innerHTML = picks.map(p => {
    const perf = p.performance || {};
    const statusColor = perf.status === 'TP_HIT' ? '#00ff66' : 
                       perf.status === 'SL_HIT' ? '#ff3333' : '#ffcc00';
    
    return `
    <div class="pick" style="border-left: 4px solid ${statusColor}">
      <div class="pick-header">
        <div>
          <div class="pick-symbol">${p.symbol}</div>
          <div class="pick-strategy">${p.strategy_full_name || p.strategy}</div>
          <div class="pick-time">${p.timestamp_est || 'Time N/A'}</div>
        </div>
        <div style="text-align: right;">
          <div class="pick-confidence" style="background: ${statusColor}; color: #000;">
            ${(p.confidence * 100).toFixed(0)}%
          </div>
          ${perf.status ? `<div style="font-size: 0.75rem; margin-top: 5px; color: ${statusColor};">${perf.status}</div>` : ''}
        </div>
      </div>
      
      ${perf.current_price ? `
      <div class="performance-box">
        <div class="performance-grid">
          <div>
            <div class="perf-value ${perf.pnl_pct >= 0 ? 'positive' : 'negative'}">
              ${perf.pnl_pct > 0 ? '+' : ''}${perf.pnl_pct.toFixed(2)}%
            </div>
            <div class="perf-label">P&L</div>
          </div>
          <div>
            <div class="perf-value">$${perf.current_price.toLocaleString()}</div>
            <div class="perf-label">CURRENT PRICE</div>
          </div>
          <div>
            <div class="perf-value ${perf.pnl_amount >= 0 ? 'positive' : 'negative'}">
              ${perf.pnl_amount > 0 ? '+' : ''}$${perf.pnl_amount.toFixed(2)}
            </div>
            <div class="perf-label">$ P&L</div>
          </div>
        </div>
        ${perf.status === 'ACTIVE' ? `
        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #333; display: flex; justify-content: space-between; font-size: 0.8rem;">
          <span style="color: #00ff66;">‚Üí TP: ${perf.tp_distance ? perf.tp_distance.toFixed(1) : '--'}%</span>
          <span style="color: #666;">Updated: ${perf.updated_at_est || 'N/A'}</span>
          <span style="color: #ff3333;">SL: ${perf.sl_distance ? perf.sl_distance.toFixed(1) : '--'}% ‚Üê</span>
        </div>
        ` : ''}
      </div>
      ` : ''}
      
      <div class="pick-details">
        <div class="detail">
          <div class="detail-value">$${p.entry_price.toLocaleString()}</div>
          <div class="detail-label">ENTRY</div>
        </div>
        <div class="detail">
          <div class="detail-value" style="color: #00ff66">$${p.tp_price.toLocaleString()}</div>
          <div class="detail-label">TARGET (+${((p.tp_price/p.entry_price-1)*100).toFixed(1)}%)</div>
        </div>
        <div class="detail">
          <div class="detail-value" style="color: #ff3333">$${p.sl_price.toLocaleString()}</div>
          <div class="detail-label">STOP (-${((1-p.sl_price/p.entry_price)*100).toFixed(1)}%)</div>
        </div>
        <div class="detail">
          <div class="detail-value">${(p.position_pct * 100).toFixed(1)}%</div>
          <div class="detail-label">SIZE</div>
        </div>
      </div>
      
      <div class="pick-reason">
        <strong>Signal:</strong> ${p.reason}
      </div>
      
      ${p.audit ? `
      <div class="audit-section">
        <div class="audit-toggle" onclick="this.nextElementSibling.style.display = this.nextElementSibling.style.display === 'none' ? 'block' : 'none'">
          üìã Show Full Audit Trail
        </div>
        <div class="audit-content" style="display: none;">
          <div style="margin-bottom: 10px;"><strong>Strategy:</strong> ${p.audit.description || 'N/A'}</div>
          
          ${p.audit.academic_basis ? `
          <div style="margin-bottom: 10px;">
            <strong>Academic Basis:</strong>
            <ul style="margin-left: 20px; margin-top: 5px;">
              ${p.audit.academic_basis.map(b => `<li>${b}</li>`).join('')}
            </ul>
          </div>` : ''}
          
          ${p.audit.entry_criteria ? `
          <div style="margin-bottom: 10px;">
            <strong>Entry Criteria:</strong>
            <ul style="margin-left: 20px; margin-top: 5px;">
              ${p.audit.entry_criteria.map(c => `<li>${c}</li>`).join('')}
            </ul>
          </div>` : ''}
          
          ${p.audit.historical_performance ? `
          <div>
            <strong>Historical Performance:</strong>
            <div style="margin-left: 10px; margin-top: 5px;">
              Win Rate: ${p.audit.historical_performance.win_rate_fg_under_15 || p.audit.historical_performance.win_rate || 'N/A'}<br>
              Expectancy: ${p.audit.historical_performance.expectancy || 'N/A'}
            </div>
          </div>` : ''}
        </div>
      </div>
      ` : ''}
      
      ${p.WARNING ? `<div class="warning-box">${p.WARNING}</div>` : ''}
    </div>
  `}).join('');
}

loadPicks();
setInterval(loadPicks, 60 * 1000); // Refresh every minute for live P&L
</script>

</body>
</html>
