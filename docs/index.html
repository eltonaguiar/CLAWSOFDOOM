<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CLAWS OF DOOM v3 - Live Picks</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'Courier New', monospace;
    background: #0a0a0a;
    color: #fff;
    line-height: 1.6;
    padding: 20px;
  }
  .header {
    text-align: center;
    padding: 30px;
    border-bottom: 3px solid #ff3333;
    margin-bottom: 30px;
  }
  .header h1 {
    font-size: 2.5rem;
    color: #ff3333;
    text-shadow: 0 0 20px #ff3333;
  }
  .header .subtitle {
    color: #ff6600;
    margin-top: 10px;
  }
  .header .timestamp {
    color: #666;
    font-size: 0.8rem;
    margin-top: 8px;
  }
  .market-snapshot {
    max-width: 1000px;
    margin: 0 auto 25px;
    background: #111;
    border: 1px solid #333;
    border-radius: 8px;
    padding: 15px 20px;
  }
  .market-snapshot h3 {
    color: #ff6600;
    font-size: 0.9rem;
    margin-bottom: 10px;
  }
  .market-row {
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 10px;
  }
  .market-item {
    text-align: center;
    flex: 1;
    min-width: 100px;
  }
  .market-item .coin { color: #ff3333; font-weight: bold; }
  .market-item .price { font-size: 1.1rem; }
  .market-item .change { font-size: 0.85rem; }
  .fg-badge {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 4px;
    font-weight: bold;
    font-size: 0.85rem;
  }
  .fg-extreme-fear { background: #ff0000; color: #fff; }
  .fg-fear { background: #ff6600; color: #fff; }
  .fg-neutral { background: #ffcc00; color: #000; }
  .fg-greed { background: #66cc00; color: #000; }
  .fg-extreme-greed { background: #00cc00; color: #000; }
  .stats {
    display: flex;
    justify-content: center;
    gap: 40px;
    margin-bottom: 30px;
    flex-wrap: wrap;
  }
  .stat { text-align: center; }
  .stat-value {
    font-size: 2rem;
    font-weight: bold;
    color: #00ff66;
  }
  .stat-label {
    font-size: 0.8rem;
    color: #888;
  }
  .picks {
    max-width: 1000px;
    margin: 0 auto;
  }
  .pick {
    background: #141414;
    border: 1px solid #333;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 15px;
  }
  .pick-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
  }
  .pick-symbol {
    font-size: 1.5rem;
    font-weight: bold;
    color: #ff3333;
  }
  .pick-strategy-name {
    font-size: 0.85rem;
    color: #ff6600;
    font-weight: bold;
  }
  .pick-strategy-tag {
    font-size: 0.7rem;
    color: #666;
  }
  .pick-confidence {
    text-align: right;
  }
  .pick-confidence .value {
    background: #00ff66;
    color: #000;
    padding: 5px 15px;
    border-radius: 4px;
    font-weight: bold;
    display: inline-block;
  }
  .pick-confidence .explanation {
    font-size: 0.65rem;
    color: #666;
    margin-top: 4px;
    max-width: 200px;
  }
  .pick-details {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 12px;
  }
  .detail { text-align: center; }
  .detail-value {
    font-size: 1.1rem;
    font-weight: bold;
  }
  .detail-label {
    font-size: 0.7rem;
    color: #888;
  }
  .pick-strategy-desc {
    margin-top: 12px;
    padding: 10px;
    background: #0d0d0d;
    border-radius: 4px;
    font-size: 0.8rem;
    color: #999;
    border-left: 3px solid #ff6600;
  }
  .pick-strategy-desc .edge-label {
    color: #ff6600;
    font-weight: bold;
  }
  .pick-reason {
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid #222;
    font-size: 0.85rem;
    color: #aaa;
  }
  .pick-timestamp {
    font-size: 0.7rem;
    color: #555;
    margin-top: 6px;
  }
  .section-title {
    max-width: 1000px;
    margin: 30px auto 15px;
    color: #ff6600;
    font-size: 1.1rem;
    border-bottom: 1px solid #333;
    padding-bottom: 8px;
  }
  .audit-container {
    max-width: 1000px;
    margin: 0 auto 30px;
  }
  .audit-toggle {
    background: #1a1a1a;
    border: 1px solid #333;
    color: #ff6600;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    font-family: inherit;
    font-size: 0.85rem;
    width: 100%;
    text-align: left;
  }
  .audit-toggle:hover { background: #222; }
  .audit-log {
    display: none;
    background: #0d0d0d;
    border: 1px solid #222;
    border-top: none;
    border-radius: 0 0 6px 6px;
    max-height: 400px;
    overflow-y: auto;
    font-size: 0.75rem;
  }
  .audit-log.open { display: block; }
  .audit-entry {
    padding: 6px 12px;
    border-bottom: 1px solid #1a1a1a;
    display: flex;
    gap: 12px;
  }
  .audit-entry:nth-child(even) { background: #111; }
  .audit-ts { color: #555; white-space: nowrap; min-width: 170px; }
  .audit-event { color: #ff6600; min-width: 140px; font-weight: bold; }
  .audit-detail { color: #999; }
  .history-container {
    max-width: 1000px;
    margin: 0 auto 30px;
  }
  .history-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.8rem;
  }
  .history-table th {
    text-align: left;
    padding: 8px;
    border-bottom: 2px solid #333;
    color: #ff6600;
  }
  .history-table td {
    padding: 6px 8px;
    border-bottom: 1px solid #1a1a1a;
    color: #ccc;
  }
  .history-table tr:nth-child(even) { background: #111; }
  .warning-banner {
    background: #331100;
    border: 2px solid #ff3333;
    border-radius: 8px;
    padding: 15px;
    text-align: center;
    margin-bottom: 15px;
    color: #ff6600;
    font-weight: bold;
  }
  .formula-box {
    max-width: 1000px;
    margin: 0 auto 20px;
    background: #111;
    border: 1px solid #333;
    border-radius: 8px;
    padding: 12px 18px;
    font-size: 0.8rem;
    color: #888;
  }
  .formula-box code {
    color: #00ff66;
    background: #0a0a0a;
    padding: 2px 6px;
    border-radius: 3px;
  }
  .loading {
    text-align: center;
    padding: 60px;
    color: #888;
  }
  .footer {
    text-align: center;
    margin-top: 40px;
    padding-top: 20px;
    border-top: 1px solid #333;
    color: #666;
    font-size: 0.8rem;
  }
  @media (max-width: 600px) {
    .pick-details { grid-template-columns: repeat(3, 1fr); }
    .stats { gap: 20px; }
    .market-row { flex-direction: column; }
  }
</style>
</head>
<body>

<div class="header">
  <h1>CLAWS OF DOOM v3</h1>
  <div class="subtitle">SYSTEM F // BULLETPROOF FAILOVER // 5 API LAYERS // FULL AUDIT TRAIL</div>
  <div class="timestamp" id="lastUpdated">Loading...</div>
  <div style="margin-top:8px;font-size:0.75rem;color:#555;">Part of the <a href="https://github.com/eltonaguiar/findtorontoevents_antigravity.ca" style="color:#ff6600;">Antigravity Trading Suite</a></div>
</div>

<!-- Tab Bar -->
<div style="max-width:1000px;margin:0 auto 20px;display:flex;gap:4px;">
  <button class="tab-btn active" onclick="switchTab('live')" id="tabLive" style="flex:1;padding:12px;background:#ff3333;color:#fff;border:none;border-radius:6px 6px 0 0;font-family:inherit;font-weight:bold;cursor:pointer;font-size:0.9rem;">LIVE PICKS</button>
  <button class="tab-btn" onclick="switchTab('methodology')" id="tabMethodology" style="flex:1;padding:12px;background:#1a1a1a;color:#888;border:1px solid #333;border-bottom:none;border-radius:6px 6px 0 0;font-family:inherit;font-weight:bold;cursor:pointer;font-size:0.9rem;">METHODOLOGY</button>
  <button class="tab-btn" onclick="switchTab('next')" id="tabNext" style="flex:1;padding:12px;background:#1a1a1a;color:#888;border:1px solid #333;border-bottom:none;border-radius:6px 6px 0 0;font-family:inherit;font-weight:bold;cursor:pointer;font-size:0.9rem;">NEXT SCAN</button>
  <button class="tab-btn" onclick="switchTab('kimi')" id="tabKimi" style="flex:1;padding:12px;background:#1a1a1a;color:#888;border:1px solid #333;border-bottom:none;border-radius:6px 6px 0 0;font-family:inherit;font-weight:bold;cursor:pointer;font-size:0.9rem;">KIMI TOP 20</button>
</div>

<!-- Methodology Tab Content -->
<div id="tabContentMethodology" style="display:none;max-width:1000px;margin:0 auto 30px;">

  <div style="background:#111;border:1px solid #333;border-radius:8px;padding:20px;margin-bottom:20px;">
    <h2 style="color:#ff3333;margin-bottom:15px;">How Claws of Doom Works</h2>
    <p style="color:#ccc;margin-bottom:15px;">Claws of Doom (System F) is a <strong style="color:#ff6600;">fully autonomous crypto trading signal generator</strong> running 24/7 via GitHub Actions. It scans 3 major cryptocurrencies every 15 minutes using 6 distinct strategies, generates entry/TP/SL signals, and tracks performance with a full audit trail.</p>

    <h3 style="color:#ff6600;margin:20px 0 10px;">Asset Coverage</h3>
    <p style="color:#ccc;margin-bottom:8px;"><strong>Crypto only</strong> — BTC, ETH, SOL (the 3 highest-liquidity coins)</p>
    <p style="color:#888;font-size:0.85rem;">Why only 3? Unlike our other systems that scan 10-200 symbols, Claws of Doom focuses on <em>depth over breadth</em>. Fewer symbols = more API redundancy per symbol = zero missed scans. The "bulletproof" guarantee requires tight scope.</p>

    <h3 style="color:#ff6600;margin:20px 0 10px;">Data Sources (5 API Fallback Layers)</h3>
    <table style="width:100%;border-collapse:collapse;font-size:0.85rem;margin-bottom:10px;">
      <tr style="border-bottom:1px solid #333;"><th style="text-align:left;padding:6px;color:#ff6600;">Layer</th><th style="text-align:left;padding:6px;color:#ff6600;">API</th><th style="text-align:left;padding:6px;color:#ff6600;">Data</th><th style="text-align:left;padding:6px;color:#ff6600;">Rate Limit</th></tr>
      <tr style="border-bottom:1px solid #1a1a1a;"><td style="padding:6px;color:#00ff66;">1 (Primary)</td><td style="padding:6px;color:#ccc;">Binance</td><td style="padding:6px;color:#888;">Spot + 24h change + funding rates</td><td style="padding:6px;color:#888;">1200/min</td></tr>
      <tr style="border-bottom:1px solid #1a1a1a;"><td style="padding:6px;color:#ffcc00;">2</td><td style="padding:6px;color:#ccc;">CoinGecko</td><td style="padding:6px;color:#888;">Spot + 24h change</td><td style="padding:6px;color:#888;">30/min (free)</td></tr>
      <tr style="border-bottom:1px solid #1a1a1a;"><td style="padding:6px;color:#ffcc00;">3</td><td style="padding:6px;color:#ccc;">CryptoCompare</td><td style="padding:6px;color:#888;">Spot + 24h change</td><td style="padding:6px;color:#888;">100K/month</td></tr>
      <tr style="border-bottom:1px solid #1a1a1a;"><td style="padding:6px;color:#ff6600;">4</td><td style="padding:6px;color:#ccc;">CoinCap</td><td style="padding:6px;color:#888;">Spot + 24h change</td><td style="padding:6px;color:#888;">200/min</td></tr>
      <tr><td style="padding:6px;color:#ff3333;">5 (Emergency)</td><td style="padding:6px;color:#ccc;">Hardcoded estimates</td><td style="padding:6px;color:#888;">Last-known prices</td><td style="padding:6px;color:#888;">N/A</td></tr>
    </table>
    <p style="color:#888;font-size:0.8rem;">+ <strong>Fear & Greed Index</strong> from <a href="https://alternative.me/crypto/fear-and-greed-index/" style="color:#ff6600;">alternative.me/crypto</a> — the most widely used crypto sentiment index. It aggregates volatility (25%), market momentum (25%), social media (15%), surveys (15%), BTC dominance (10%), and Google Trends (10%) into a single 0-100 score. When it drops below 25, historically that marks buying opportunities.</p>

    <h3 style="color:#ff6600;margin:20px 0 10px;">The 6 Strategies</h3>

    <div style="background:#0d0d0d;border-left:3px solid #00ff66;padding:12px;margin-bottom:10px;border-radius:0 6px 6px 0;">
      <div style="color:#00ff66;font-weight:bold;margin-bottom:4px;">1. Extreme Fear Contrarian (LONG)</div>
      <div style="color:#ccc;font-size:0.85rem;">Buys when F&G drops to 25 or below. Retail panic-sells at bottoms while smart money accumulates. Backtest (2018-2024): buying at F&G &le; 20 yields median +12% over 30 days for BTC.</div>
      <div style="color:#888;font-size:0.8rem;margin-top:4px;">TP: +6% | SL: -5% | Position: 3.5% of capital</div>
    </div>

    <div style="background:#0d0d0d;border-left:3px solid #00ff66;padding:12px;margin-bottom:10px;border-radius:0 6px 6px 0;">
      <div style="color:#00ff66;font-weight:bold;margin-bottom:4px;">2. Crash Reversal Bounce (LONG)</div>
      <div style="color:#ccc;font-size:0.85rem;">Triggers when a coin drops &gt;10% in 24h. Large single-day drops mean-revert within 3-7 days due to short covering and bargain hunting.</div>
      <div style="color:#888;font-size:0.8rem;margin-top:4px;">TP: +5% | SL: -4% | Position: 3.0% of capital</div>
    </div>

    <div style="background:#0d0d0d;border-left:3px solid #00ff66;padding:12px;margin-bottom:10px;border-radius:0 6px 6px 0;">
      <div style="color:#00ff66;font-weight:bold;margin-bottom:4px;">3. Momentum Breakout (LONG)</div>
      <div style="color:#ccc;font-size:0.85rem;">Buys when a coin is up &gt;5% in 24h AND F&G &gt; 50 (Greed territory). Momentum persists in crypto — breakouts with positive sentiment continue 2-5 more days.</div>
      <div style="color:#888;font-size:0.8rem;margin-top:4px;">TP: +8% | SL: -6% | Position: 2.5% of capital</div>
    </div>

    <div style="background:#0d0d0d;border-left:3px solid #ff3333;padding:12px;margin-bottom:10px;border-radius:0 6px 6px 0;">
      <div style="color:#ff3333;font-weight:bold;margin-bottom:4px;">4. RSI Overbought + SMA Breakdown (SHORT)</div>
      <div style="color:#ccc;font-size:0.85rem;">Shorts when RSI(14) &gt; 70 AND price is below 200-SMA. Exhaustion rallies in downtrends tend to reverse. 60-65% historical win rate (QuantifiedStrategies).</div>
      <div style="color:#888;font-size:0.8rem;margin-top:4px;">TP: -5% | SL: +3% | Position: 2.5% of capital</div>
    </div>

    <div style="background:#0d0d0d;border-left:3px solid #ff3333;padding:12px;margin-bottom:10px;border-radius:0 6px 6px 0;">
      <div style="color:#ff3333;font-weight:bold;margin-bottom:4px;">5. EMA Bearish Cross + RSI Divergence (SHORT)</div>
      <div style="color:#ccc;font-size:0.85rem;">Triggers when EMA(12) crosses below EMA(50) with RSI divergence, filtered by F&G &lt; 40. 51.72% net profit on XRP/USDT 3H during 2022 bear (altFINS research).</div>
      <div style="color:#888;font-size:0.8rem;margin-top:4px;">TP: -6% | SL: +4% | Position: 2.0% of capital</div>
    </div>

    <div style="background:#0d0d0d;border-left:3px solid #ffcc00;padding:12px;margin-bottom:10px;border-radius:0 6px 6px 0;">
      <div style="color:#ffcc00;font-weight:bold;margin-bottom:4px;">6. Funding Rate Carry (LONG or SHORT)</div>
      <div style="color:#ccc;font-size:0.85rem;">Market-neutral: when Binance perp funding &gt;0.05%, shorts perp (longs pay shorts). When funding &lt;-0.03%, goes long. Documented 15-45% annually (CoinCryptoRank, Gate.io).</div>
      <div style="color:#888;font-size:0.8rem;margin-top:4px;">TP: &plusmn;3% | SL: &plusmn;2% | Position: 4.0% of capital</div>
    </div>

    <h3 style="color:#ff6600;margin:20px 0 10px;">Confidence Scoring Formula</h3>
    <div style="background:#0d0d0d;padding:15px;border-radius:6px;font-size:0.85rem;">
      <code style="color:#00ff66;">confidence = base(0.55) + fear_bonus(0-0.15) + momentum_bonus(0-0.10)</code>
      <ul style="color:#ccc;margin:10px 0 0 20px;">
        <li><strong style="color:#ff6600;">Base = 0.55</strong> — Just above coin flip. Honest about uncertainty.</li>
        <li><strong style="color:#ff6600;">Fear bonus (0-0.15)</strong> — Scales with how extreme the F&G reading is. F&G=10 gets full bonus.</li>
        <li><strong style="color:#ff6600;">Momentum bonus (0-0.10)</strong> — Scales with the size of the 24h price move.</li>
        <li><strong style="color:#ff6600;">Max = 0.80</strong> — Capped to prevent overconfidence.</li>
      </ul>
    </div>

    <h3 style="color:#ff6600;margin:20px 0 10px;">Why These Picks?</h3>
    <p style="color:#ccc;font-size:0.85rem;margin-bottom:10px;">Every pick includes a <code style="color:#00ff66;background:#0a0a0a;padding:2px 6px;border-radius:3px;">reason</code> field explaining exactly why it was generated. The system only generates a pick when a strategy's conditions are met — there are no random or filler picks. If no conditions trigger, the dashboard shows "No active picks."</p>
    <p style="color:#ccc;font-size:0.85rem;">Each pick card shows: the strategy name, a full strategy description, the documented edge, the confidence formula breakdown, entry/TP/SL levels, position sizing, and the specific market condition that triggered it (e.g., "Fear & Greed = 11 (Extreme Fear), SOL +7.4% 24h").</p>

    <h3 style="color:#ff6600;margin:20px 0 10px;">Automation Pipeline</h3>
    <table style="width:100%;border-collapse:collapse;font-size:0.85rem;">
      <tr style="border-bottom:1px solid #333;"><th style="text-align:left;padding:6px;color:#ff6600;">Step</th><th style="text-align:left;padding:6px;color:#ff6600;">What Happens</th></tr>
      <tr style="border-bottom:1px solid #1a1a1a;"><td style="padding:6px;color:#ccc;">1. Trigger</td><td style="padding:6px;color:#888;">GitHub Actions cron fires every 15 minutes</td></tr>
      <tr style="border-bottom:1px solid #1a1a1a;"><td style="padding:6px;color:#ccc;">2. Price Fetch</td><td style="padding:6px;color:#888;">Try Binance &rarr; CoinGecko &rarr; CryptoCompare &rarr; CoinCap &rarr; Emergency estimates</td></tr>
      <tr style="border-bottom:1px solid #1a1a1a;"><td style="padding:6px;color:#ccc;">3. F&G Fetch</td><td style="padding:6px;color:#888;">Fetch Fear & Greed from alternative.me (with fallback estimation)</td></tr>
      <tr style="border-bottom:1px solid #1a1a1a;"><td style="padding:6px;color:#ccc;">4. Strategy Eval</td><td style="padding:6px;color:#888;">Run all 6 strategies against current market data</td></tr>
      <tr style="border-bottom:1px solid #1a1a1a;"><td style="padding:6px;color:#ccc;">5. TP/SL Check</td><td style="padding:6px;color:#888;">Validate active picks against current prices (close if TP/SL hit)</td></tr>
      <tr style="border-bottom:1px solid #1a1a1a;"><td style="padding:6px;color:#ccc;">6. Commit</td><td style="padding:6px;color:#888;">Write picks.json, active_picks.json, closed_picks.json, picks_history.json</td></tr>
      <tr><td style="padding:6px;color:#ccc;">7. Deploy</td><td style="padding:6px;color:#888;">GitHub Pages auto-deploys updated dashboard</td></tr>
    </table>

    <h3 style="color:#ff6600;margin:20px 0 10px;">Capital & Risk Model</h3>
    <ul style="color:#ccc;font-size:0.85rem;margin-left:20px;">
      <li>Base capital: <strong>$10,000</strong> (simulated)</li>
      <li>Position sizes: 2.0%-4.0% per trade depending on strategy</li>
      <li>Max concurrent picks: no hard limit (but 3 symbols limits exposure naturally)</li>
      <li>All P&L tracked in both % and $ terms</li>
    </ul>

    <h3 style="color:#ff6600;margin:20px 0 10px;">Source Code</h3>
    <ul style="color:#ccc;font-size:0.85rem;margin-left:20px;">
      <li><a href="https://github.com/eltonaguiar/CLAWSOFDOOM" style="color:#ff6600;">CLAWSOFDOOM repo</a> — Engine, dashboard, workflow</li>
      <li><a href="https://github.com/eltonaguiar/findtorontoevents_antigravity.ca" style="color:#ff6600;">Antigravity main repo</a> — Mirrored as System F</li>
      <li>Engine: <code style="color:#00ff66;">systems/claws_engine.py</code> (~52KB, full strategy logic)</li>
      <li>Bulletproof fallback: <code style="color:#00ff66;">systems/claws_bulletproof.py</code></li>
      <li>Workflow: <code style="color:#00ff66;">.github/workflows/trade.yml</code> (every 15 min)</li>
    </ul>
  </div>
</div>

<!-- Next Scan Tab Content -->
<div id="tabContentNext" style="display:none;max-width:1000px;margin:0 auto 30px;">
  <div style="background:#111;border:1px solid #333;border-radius:8px;padding:20px;">
    <h2 style="color:#ff3333;margin-bottom:15px;">Next Scan Schedule</h2>
    <div style="background:#0d0d0d;border:1px solid #333;border-radius:8px;padding:20px;text-align:center;margin-bottom:20px;">
      <div style="color:#888;font-size:0.85rem;">NEXT SCAN IN</div>
      <div id="nextScanCountdown" style="color:#ff3333;font-size:2.5rem;font-weight:bold;text-shadow:0 0 10px #ff3333;">--:--</div>
      <div style="color:#555;font-size:0.8rem;margin-top:8px;">Scans run at :00, :15, :30, :45 every hour (UTC)</div>
    </div>
    <h3 style="color:#ff6600;margin:20px 0 10px;">What Happens Each Scan</h3>
    <ul style="color:#ccc;font-size:0.85rem;margin-left:20px;line-height:2;">
      <li>Fetches live prices from up to 5 APIs (guaranteed price data)</li>
      <li>Checks Fear & Greed Index for regime context</li>
      <li>Evaluates all 6 strategies against BTC, ETH, SOL</li>
      <li>Validates existing picks (close at TP or SL if hit)</li>
      <li>Generates new picks ONLY when strategy conditions are met</li>
      <li>Updates dashboard JSON — page auto-refreshes every 5 minutes</li>
    </ul>
    <h3 style="color:#ff6600;margin:20px 0 10px;">When Will New Picks Be Issued?</h3>
    <p style="color:#ccc;font-size:0.85rem;">New picks are issued <strong>only when market conditions trigger a strategy</strong>. In current extreme fear (F&G=11), the <span style="color:#00ff66;">Extreme Fear Contrarian</span> strategy is active. Other strategies will trigger when:</p>
    <ul style="color:#888;font-size:0.85rem;margin-left:20px;line-height:2;">
      <li><strong style="color:#ccc;">Crash Reversal:</strong> Any of BTC/ETH/SOL drops &gt;10% in 24h</li>
      <li><strong style="color:#ccc;">Momentum Breakout:</strong> F&G rises above 50 AND a coin is up &gt;5%</li>
      <li><strong style="color:#ccc;">RSI Short:</strong> RSI(14) &gt; 70 while below 200-SMA</li>
      <li><strong style="color:#ccc;">EMA Cross Short:</strong> EMA(12) crosses below EMA(50) with RSI divergence</li>
      <li><strong style="color:#ccc;">Funding Carry:</strong> Binance funding rate exceeds &plusmn;0.03-0.05%</li>
    </ul>
  </div>
</div>

<!-- KIMI Top 20 Strategies Tab Content -->
<div id="tabContentKimi" style="display:none;max-width:1000px;margin:0 auto 30px;">
  <div style="background:#111;border:1px solid #333;border-radius:8px;padding:20px;">
    <h2 style="color:#ff3333;margin-bottom:8px;">KIMI Rise of the Claw — Top 20 Strategies</h2>
    <p style="color:#888;font-size:0.85rem;margin-bottom:15px;">Forward-tested performance of the top 20 strategies from KIMI's 81-algorithm engine (v11.0). Ranked by Sharpe ratio. Data from live forward testing.</p>
    <div id="kimiTableContainer" style="overflow-x:auto;">
      <div style="text-align:center;padding:20px;color:#888;">Loading KIMI strategies...</div>
    </div>
    <div style="margin-top:15px;padding:12px;background:#0d0d0d;border-radius:6px;font-size:0.8rem;color:#888;">
      <strong style="color:#ff6600;">About KIMI Rise of the Claw:</strong> An autonomous 81-algorithm crypto/forex trading engine running every 15 minutes via GitHub Actions. Features an elimination engine (danger zone &rarr; probation &rarr; elimination), ML signal ranker, and SQLite persistence. See the <a href="https://eltonaguiar.github.io/findtorontoevents_antigravity.ca/monitor/" style="color:#ff6600;">Cross-System Monitor</a> for live aggregated data.
    </div>
  </div>
</div>

<!-- Live Tab Content (wraps existing UI) -->
<div id="tabContentLive">

<div class="market-snapshot" id="marketSnapshot" style="display:none;">
  <h3>MARKET SNAPSHOT</h3>
  <div id="marketContent"></div>
</div>

<div class="stats">
  <div class="stat">
    <div class="stat-value" id="totalPicks">--</div>
    <div class="stat-label">ACTIVE PICKS</div>
  </div>
  <div class="stat">
    <div class="stat-value" id="avgConfidence">--</div>
    <div class="stat-label">AVG CONFIDENCE</div>
  </div>
  <div class="stat">
    <div class="stat-value" id="fearGreed">--</div>
    <div class="stat-label">FEAR & GREED</div>
  </div>
  <div class="stat">
    <div class="stat-value" id="priceSource">--</div>
    <div class="stat-label">DATA SOURCE</div>
  </div>
  <div class="stat">
    <div class="stat-value" id="winRate">--</div>
    <div class="stat-label">WIN RATE</div>
  </div>
  <div class="stat">
    <div class="stat-value" id="totalPnl">--</div>
    <div class="stat-label">TOTAL P&L</div>
  </div>
</div>

<div id="formulaBox" class="formula-box" style="display:none;"></div>

<div class="section-title" id="activeTitle" style="display:none;">ACTIVE PICKS — LIVE PERFORMANCE</div>
<div class="picks" id="activePicksContainer"></div>

<div class="picks" id="picksContainer">
  <div class="loading">Loading picks...</div>
</div>

<div class="section-title" id="closedTitle" style="display:none;">RECENTLY CLOSED PICKS</div>
<div class="history-container" id="closedContainer" style="display:none;"></div>

<div class="section-title" id="historyTitle" style="display:none;">PICK HISTORY (Last 50)</div>
<div class="history-container" id="historyContainer" style="display:none;"></div>

<div class="section-title" id="auditTitle" style="display:none;">AUDIT TRAIL</div>
<div class="audit-container" id="auditContainer" style="display:none;"></div>

<!-- End of Live tab content -->
</div>

<div class="footer">
  System F — Claws of Doom v3 | Updates every 15 minutes via GitHub Actions | 6 strategies (3 long, 2 short, 1 carry) | 5 API fallbacks | Full audit trail | EST timestamps
</div>

<script>
async function loadPicks() {
  const sources = [
    './picks.json',
    'picks.json',
    'https://raw.githubusercontent.com/eltonaguiar/CLAWSOFDOOM/main/docs/picks.json',
    'https://cdn.jsdelivr.net/gh/eltonaguiar/CLAWSOFDOOM@main/docs/picks.json'
  ];

  for (const url of sources) {
    try {
      const resp = await fetch(url, { cache: 'no-store' });
      if (resp.ok) {
        const data = await resp.json();
        renderAll(data);
        return;
      }
    } catch (e) {
      console.warn('Failed:', url, e.message);
    }
  }

  document.getElementById('picksContainer').innerHTML = `
    <div style="text-align:center;padding:40px;">
      <div style="color:#ff3333;font-size:1.2rem;margin-bottom:15px;">UNABLE TO LOAD PICKS</div>
      <div style="color:#888;margin-bottom:20px;">Retrying in 10s...</div>
      <button onclick="location.reload()" style="background:#ff3333;color:#fff;border:none;padding:10px 30px;border-radius:4px;cursor:pointer;font-family:inherit;">REFRESH</button>
    </div>`;
  setTimeout(loadPicks, 10000);
}

async function loadHistory() {
  const sources = [
    './picks_history.json',
    'picks_history.json',
    'https://raw.githubusercontent.com/eltonaguiar/CLAWSOFDOOM/main/docs/picks_history.json'
  ];
  for (const url of sources) {
    try {
      const resp = await fetch(url, { cache: 'no-store' });
      if (resp.ok) return await resp.json();
    } catch(e) {}
  }
  return null;
}

function fgClass(value) {
  if (value <= 20) return 'fg-extreme-fear';
  if (value <= 40) return 'fg-fear';
  if (value <= 60) return 'fg-neutral';
  if (value <= 80) return 'fg-greed';
  return 'fg-extreme-greed';
}

function fgLabel(value) {
  if (value <= 20) return 'Extreme Fear';
  if (value <= 40) return 'Fear';
  if (value <= 60) return 'Neutral';
  if (value <= 80) return 'Greed';
  return 'Extreme Greed';
}

function fmt(n) {
  return Number(n).toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2});
}

function pnlColor(v) { return v >= 0 ? '#00ff66' : '#ff3333'; }
function pnlSign(v) { return v >= 0 ? '+' : ''; }

function renderPickCard(p, showLivePnl) {
  const hasFallback = p.strategy === 'ULTIMATE_FALLBACK';
  const warningHtml = hasFallback
    ? `<div class="warning-banner">${p.WARNING || 'VERIFY PRICE BEFORE TRADING'}</div>` : '';

  const stratDesc = p.strategy_description
    ? `<div class="pick-strategy-desc">
        <div>${p.strategy_description}</div>
        ${p.strategy_edge ? `<div style="margin-top:6px;"><span class="edge-label">Edge:</span> ${p.strategy_edge}</div>` : ''}
       </div>` : '';

  const confExpl = p.confidence_explanation
    ? `<div class="explanation">${p.confidence_explanation}</div>` : '';

  // Live P&L section
  let livePnl = '';
  if (showLivePnl && p.current_price) {
    const pnlPct = p.unrealized_pnl_pct || ((p.current_price - p.entry_price) / p.entry_price * 100);
    const pnlDollar = p.unrealized_pnl_dollar || 0;
    const color = pnlColor(pnlPct);
    livePnl = `
      <div style="background:#0d0d0d;border:1px solid #333;border-radius:6px;padding:12px;margin-top:12px;">
        <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;">
          <div>
            <span style="color:#888;font-size:0.75rem;">CURRENT PRICE</span>
            <div style="font-size:1.3rem;font-weight:bold;">$${fmt(p.current_price)}</div>
          </div>
          <div style="text-align:center;">
            <span style="color:#888;font-size:0.75rem;">UNREALIZED P&L</span>
            <div style="font-size:1.3rem;font-weight:bold;color:${color}">${pnlSign(pnlPct)}${pnlPct.toFixed(2)}%</div>
          </div>
          <div style="text-align:right;">
            <span style="color:#888;font-size:0.75rem;">DOLLAR P&L</span>
            <div style="font-size:1.3rem;font-weight:bold;color:${color}">${pnlSign(pnlDollar)}$${Math.abs(pnlDollar).toFixed(2)}</div>
          </div>
          <div style="text-align:right;">
            <span style="color:#888;font-size:0.75rem;">LAST CHECK</span>
            <div style="font-size:0.8rem;color:#666;">${p.last_checked_est || ''}</div>
          </div>
        </div>
      </div>`;
  }

  const dirColor = p.direction === 'SHORT' ? '#ff3333' : (p.direction === 'LONG' ? '#00ff66' : '#ffcc00');
  const dirBadge = `<span style="background:${dirColor};color:#000;padding:2px 8px;border-radius:3px;font-size:0.75rem;font-weight:bold;margin-left:8px;">${p.direction || 'LONG'}</span>`;

  return `
    <div class="pick" style="border-left:3px solid ${dirColor}">
      ${warningHtml}
      <div class="pick-header">
        <div>
          <div class="pick-symbol">${p.symbol} ${dirBadge}</div>
          <div class="pick-strategy-name">${p.strategy_name || p.strategy.toUpperCase()}</div>
          <div class="pick-strategy-tag">${p.strategy}</div>
        </div>
        <div class="pick-confidence">
          <div class="value">${(p.confidence * 100).toFixed(0)}%</div>
          ${confExpl}
        </div>
      </div>
      <div class="pick-details">
        <div class="detail">
          <div class="detail-value">$${fmt(p.entry_price)}</div>
          <div class="detail-label">ENTRY</div>
        </div>
        <div class="detail">
          <div class="detail-value" style="color:#00ff66">$${fmt(p.tp_price)}</div>
          <div class="detail-label">TARGET (+${((p.tp_price/p.entry_price-1)*100).toFixed(1)}%)</div>
        </div>
        <div class="detail">
          <div class="detail-value" style="color:#ff3333">$${fmt(p.sl_price)}</div>
          <div class="detail-label">STOP (-${((1-p.sl_price/p.entry_price)*100).toFixed(1)}%)</div>
        </div>
        <div class="detail">
          <div class="detail-value">${p.risk_reward_ratio || 'N/A'}</div>
          <div class="detail-label">R:R RATIO</div>
        </div>
        <div class="detail">
          <div class="detail-value">${(p.position_pct * 100).toFixed(1)}%</div>
          <div class="detail-label">SIZE ($${(p.position_pct * 10000).toFixed(0)})</div>
        </div>
      </div>
      ${livePnl}
      ${stratDesc}
      <div class="pick-reason">${p.reason}</div>
      <div class="pick-timestamp">${p.timestamp_est || p.timestamp || ''} | Source: ${p.data_source || 'unknown'}</div>
    </div>`;
}

function renderAll(data) {
  // Header timestamp
  const ts = data.generated_at_est || data.generated_at || 'unknown';
  document.getElementById('lastUpdated').textContent = `Last updated: ${ts}`;

  // Market snapshot
  const ms = data.market_snapshot;
  if (ms && ms.prices && Object.keys(ms.prices).length > 0) {
    document.getElementById('marketSnapshot').style.display = 'block';
    const fg = ms.fear_greed;
    let html = `<div style="margin-bottom:10px;">Fear & Greed: <span class="fg-badge ${fgClass(fg)}">${fg} — ${fgLabel(fg)}</span> <span style="color:#555;font-size:0.75rem;">(${ms.fear_greed_source || 'unknown'})</span></div>`;
    html += '<div class="market-row">';
    for (const [coin, info] of Object.entries(ms.prices)) {
      const changeColor = info.change_24h_pct >= 0 ? '#00ff66' : '#ff3333';
      html += `<div class="market-item">
        <div class="coin">${coin}</div>
        <div class="price">$${fmt(info.price)}</div>
        <div class="change" style="color:${changeColor}">${info.change_24h_pct >= 0 ? '+' : ''}${info.change_24h_pct.toFixed(1)}%</div>
      </div>`;
    }
    html += '</div>';
    document.getElementById('marketContent').innerHTML = html;
    document.getElementById('fearGreed').textContent = fg;
    document.getElementById('priceSource').textContent = (ms.price_source || '--').toUpperCase();
  }

  // Performance stats
  const perf = data.performance || {};
  if (perf.total_closed > 0) {
    document.getElementById('winRate').textContent = perf.win_rate_pct + '%';
    const totalPnl = (perf.total_realized_pnl_dollar || 0) + (perf.total_unrealized_pnl_dollar || 0);
    document.getElementById('totalPnl').textContent = `${pnlSign(totalPnl)}$${Math.abs(totalPnl).toFixed(2)}`;
    document.getElementById('totalPnl').style.color = pnlColor(totalPnl);
  }

  // Confidence formula
  if (data.confidence_formula) {
    const fb = document.getElementById('formulaBox');
    fb.style.display = 'block';
    fb.innerHTML = `<strong style="color:#ff6600;">How confidence is calculated:</strong> ${data.confidence_formula}`;
  }

  // Active picks with live P&L
  const activePicks = data.active_picks || [];
  const activeWithPnl = activePicks.filter(p => p.current_price);
  if (activeWithPnl.length > 0) {
    document.getElementById('activeTitle').style.display = 'block';
    document.getElementById('activePicksContainer').innerHTML = activeWithPnl.map(p => renderPickCard(p, true)).join('');
    document.getElementById('totalPicks').textContent = activeWithPnl.length;
    const avgConf = (activeWithPnl.reduce((a,b) => a + b.confidence, 0) / activeWithPnl.length * 100).toFixed(0) + '%';
    document.getElementById('avgConfidence').textContent = avgConf;
  }

  // New picks (latest scan)
  const picks = data.picks || [];
  if (picks.length === 0 && activeWithPnl.length === 0) {
    document.getElementById('picksContainer').innerHTML =
      '<div class="loading">No active picks. No strategies triggered for current market conditions.</div>';
    document.getElementById('totalPicks').textContent = '0';
  } else if (picks.length > 0) {
    // Show new scan picks (without live P&L since they're brand new)
    document.getElementById('picksContainer').innerHTML =
      `<div class="section-title">LATEST SCAN PICKS</div>` +
      picks.map(p => renderPickCard(p, false)).join('');
    if (activeWithPnl.length === 0) {
      document.getElementById('totalPicks').textContent = picks.length;
      const avgConf = (picks.reduce((a,b) => a + b.confidence, 0) / picks.length * 100).toFixed(0) + '%';
      document.getElementById('avgConfidence').textContent = avgConf;
    }
  } else {
    document.getElementById('picksContainer').innerHTML = '';
  }

  // Closed picks
  const closed = data.closed_picks_recent || [];
  if (closed.length > 0) {
    document.getElementById('closedTitle').style.display = 'block';
    const cc = document.getElementById('closedContainer');
    cc.style.display = 'block';
    cc.innerHTML = `
      <table class="history-table">
        <thead>
          <tr>
            <th>Symbol</th>
            <th>Strategy</th>
            <th>Entry</th>
            <th>Exit</th>
            <th>Result</th>
            <th>P&L %</th>
            <th>P&L $</th>
            <th>Exit Time</th>
          </tr>
        </thead>
        <tbody>
          ${closed.reverse().map(c => {
            const isWin = c.exit_reason === 'TP_HIT';
            const color = isWin ? '#00ff66' : '#ff3333';
            const badge = isWin ? 'WIN' : 'LOSS';
            return `<tr>
              <td style="color:#ff3333;font-weight:bold;">${c.symbol}</td>
              <td>${c.strategy}</td>
              <td>$${fmt(c.entry_price)}</td>
              <td>$${fmt(c.exit_price)}</td>
              <td style="color:${color};font-weight:bold;">${badge}</td>
              <td style="color:${color}">${pnlSign(c.realized_pnl_pct)}${(c.realized_pnl_pct||0).toFixed(2)}%</td>
              <td style="color:${color}">${pnlSign(c.realized_pnl_dollar)}$${Math.abs(c.realized_pnl_dollar||0).toFixed(2)}</td>
              <td>${c.exit_time_est || ''}</td>
            </tr>`;
          }).join('')}
        </tbody>
      </table>`;
  }

  // Audit trail
  const audit = data.audit_trail || [];
  if (audit.length > 0) {
    document.getElementById('auditTitle').style.display = 'block';
    const ac = document.getElementById('auditContainer');
    ac.style.display = 'block';
    ac.innerHTML = `
      <button class="audit-toggle" onclick="this.nextElementSibling.classList.toggle('open')">
        Show/Hide Audit Trail (${audit.length} entries)
      </button>
      <div class="audit-log">
        ${audit.map(a => `
          <div class="audit-entry">
            <span class="audit-ts">${a.timestamp_est || ''}</span>
            <span class="audit-event">${a.event}</span>
            <span class="audit-detail">${a.detail || ''}</span>
          </div>
        `).join('')}
      </div>`;
  }

  // Load history
  loadHistory().then(history => {
    if (!history || history.length === 0) return;
    document.getElementById('historyTitle').style.display = 'block';
    const hc = document.getElementById('historyContainer');
    hc.style.display = 'block';

    const recent = history.slice(-50).reverse();
    hc.innerHTML = `
      <table class="history-table">
        <thead>
          <tr>
            <th>Time (EST)</th>
            <th>Symbol</th>
            <th>Strategy</th>
            <th>Dir</th>
            <th>Entry</th>
            <th>TP</th>
            <th>SL</th>
            <th>Conf</th>
            <th>Source</th>
          </tr>
        </thead>
        <tbody>
          ${recent.map(h => `
            <tr>
              <td>${h.timestamp_est || ''}</td>
              <td style="color:#ff3333;font-weight:bold;">${h.symbol}</td>
              <td>${h.strategy}</td>
              <td>${h.direction}</td>
              <td>$${fmt(h.entry_price)}</td>
              <td style="color:#00ff66">$${fmt(h.tp_price)}</td>
              <td style="color:#ff3333">$${fmt(h.sl_price)}</td>
              <td>${(h.confidence*100).toFixed(0)}%</td>
              <td>${h.data_source || ''}</td>
            </tr>
          `).join('')}
        </tbody>
      </table>`;
  });
}

loadPicks();
setInterval(loadPicks, 5 * 60 * 1000);

// Tab switching
const tabMap = {live:'tabLive', methodology:'tabMethodology', next:'tabNext', kimi:'tabKimi'};
function switchTab(tab) {
  ['Live','Methodology','Next','Kimi'].forEach(t => {
    const key = t.toLowerCase();
    document.getElementById('tabContent'+t).style.display = key === tab ? 'block' : 'none';
    const btn = document.getElementById('tab'+t);
    if (key === tab) {
      btn.style.background = '#ff3333';
      btn.style.color = '#fff';
      btn.style.border = 'none';
    } else {
      btn.style.background = '#1a1a1a';
      btn.style.color = '#888';
      btn.style.border = '1px solid #333';
      btn.style.borderBottom = 'none';
    }
  });
  if (tab === 'kimi') loadKimiStrategies();
}

// KIMI Top 20 Strategies loader
let kimiLoaded = false;
async function loadKimiStrategies() {
  if (kimiLoaded) return;
  const sources = [
    './kimi_top20.json',
    'kimi_top20.json',
    'https://raw.githubusercontent.com/eltonaguiar/CLAWSOFDOOM/main/docs/kimi_top20.json'
  ];
  for (const url of sources) {
    try {
      const resp = await fetch(url, {cache:'no-store'});
      if (!resp.ok) continue;
      const data = await resp.json();
      renderKimiTable(data);
      kimiLoaded = true;
      return;
    } catch(e) {}
  }
  document.getElementById('kimiTableContainer').innerHTML = '<div style="color:#ff3333;text-align:center;">Failed to load KIMI strategies data.</div>';
}

function renderKimiTable(strategies) {
  const medalColors = ['#ffd700','#c0c0c0','#cd7f32'];
  let html = `<table style="width:100%;border-collapse:collapse;font-size:0.8rem;">
    <thead>
      <tr style="border-bottom:2px solid #ff3333;">
        <th style="padding:8px;text-align:center;color:#ff6600;">#</th>
        <th style="padding:8px;text-align:left;color:#ff6600;">Strategy</th>
        <th style="padding:8px;text-align:right;color:#ff6600;">Sharpe</th>
        <th style="padding:8px;text-align:right;color:#ff6600;">Return</th>
        <th style="padding:8px;text-align:right;color:#ff6600;">Win Rate</th>
        <th style="padding:8px;text-align:right;color:#ff6600;">Max DD</th>
        <th style="padding:8px;text-align:right;color:#ff6600;">PF</th>
        <th style="padding:8px;text-align:right;color:#ff6600;">Trades</th>
      </tr>
    </thead><tbody>`;

  strategies.forEach(s => {
    const medal = s.rank <= 3 ? ` style="color:${medalColors[s.rank-1]};font-weight:bold;"` : '';
    const retColor = s.return_pct >= 0 ? '#00ff66' : '#ff3333';
    const ddColor = '#ff3333';
    const wrColor = s.win_rate_pct >= 60 ? '#00ff66' : (s.win_rate_pct >= 50 ? '#ffcc00' : '#ff3333');
    const bg = s.rank % 2 === 0 ? 'background:#111;' : '';
    const name = s.name.length > 50 ? s.name.substring(0,47) + '...' : s.name;

    html += `<tr style="${bg}border-bottom:1px solid #1a1a1a;">
      <td style="padding:6px;text-align:center;"${medal}>${s.rank}</td>
      <td style="padding:6px;color:#ccc;" title="${s.name}">${name}</td>
      <td style="padding:6px;text-align:right;color:#00ff66;font-weight:bold;">${s.sharpe.toFixed(2)}</td>
      <td style="padding:6px;text-align:right;color:${retColor};">${s.return_pct >= 0 ? '+' : ''}${s.return_pct.toFixed(1)}%</td>
      <td style="padding:6px;text-align:right;color:${wrColor};">${s.win_rate_pct.toFixed(1)}%</td>
      <td style="padding:6px;text-align:right;color:${ddColor};">${s.max_drawdown_pct.toFixed(1)}%</td>
      <td style="padding:6px;text-align:right;color:#ccc;">${s.profit_factor.toFixed(2)}</td>
      <td style="padding:6px;text-align:right;color:#888;">${s.trades}</td>
    </tr>`;
  });

  html += '</tbody></table>';

  // Summary stats
  const avgSharpe = strategies.reduce((a,b) => a + b.sharpe, 0) / strategies.length;
  const avgWR = strategies.reduce((a,b) => a + b.win_rate_pct, 0) / strategies.length;
  const avgReturn = strategies.reduce((a,b) => a + b.return_pct, 0) / strategies.length;
  const totalTrades = strategies.reduce((a,b) => a + b.trades, 0);

  html = `<div style="display:flex;gap:20px;justify-content:center;margin-bottom:15px;flex-wrap:wrap;">
    <div style="text-align:center;"><div style="color:#00ff66;font-size:1.5rem;font-weight:bold;">${avgSharpe.toFixed(2)}</div><div style="color:#888;font-size:0.75rem;">AVG SHARPE</div></div>
    <div style="text-align:center;"><div style="color:#00ff66;font-size:1.5rem;font-weight:bold;">${avgWR.toFixed(1)}%</div><div style="color:#888;font-size:0.75rem;">AVG WIN RATE</div></div>
    <div style="text-align:center;"><div style="color:#00ff66;font-size:1.5rem;font-weight:bold;">+${avgReturn.toFixed(1)}%</div><div style="color:#888;font-size:0.75rem;">AVG RETURN</div></div>
    <div style="text-align:center;"><div style="color:#ffcc00;font-size:1.5rem;font-weight:bold;">${totalTrades}</div><div style="color:#888;font-size:0.75rem;">TOTAL TRADES</div></div>
  </div>` + html;

  document.getElementById('kimiTableContainer').innerHTML = html;
}

// Next scan countdown
function updateCountdown() {
  const now = new Date();
  const mins = now.getUTCMinutes();
  const secs = now.getUTCSeconds();
  const nextQuarter = Math.ceil((mins + 1) / 15) * 15;
  const minsLeft = (nextQuarter - mins - 1 + 60) % 60 || (mins % 15 === 0 && secs === 0 ? 0 : (15 - (mins % 15) - 1));
  const secsLeft = (60 - secs) % 60;
  const totalSecs = minsLeft * 60 + secsLeft;
  const m = Math.floor(totalSecs / 60);
  const s = totalSecs % 60;
  const el = document.getElementById('nextScanCountdown');
  if (el) el.textContent = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
}
setInterval(updateCountdown, 1000);
updateCountdown();
</script>

</body>
</html>
